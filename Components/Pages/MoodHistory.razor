@page "/moodhistory"
@using MoodSync.Data
@using Radzen.Blazor
@inject MoodSyncContext DbContext

<PageTitle>Mood History</PageTitle>
<h1>Mood History</h1>

<div style="width: 100%; max-width: 600px; margin: 0 auto;">
    <RadzenChart>
        <RadzenLineSeries Data="@moodData" CategoryProperty="Date" Title="Mood" ValueProperty="Value" Smooth="true">
            <RadzenMarkers MarkerType="MarkerType.Circle" />
        </RadzenLineSeries>
        <RadzenValueAxis Min="0" Max="3" Step="1" />
        <RadzenCategoryAxis Padding="20" />
    </RadzenChart>
</div>

@code {
    class MoodDataPoint
    {
        public string Date { get; set; }
        public int Value { get; set; }
    }

    private List<MoodDataPoint> moodData = new List<MoodDataPoint>();

    protected override void OnInitialized()
    {
        LoadMoodData();
    }

    private void LoadMoodData()
    {
        var entries = DbContext.MoodEntries
            .OrderByDescending(e => e.Timestamp)
            .Take(7)
            .OrderBy(e => e.Timestamp)
            .ToList();

        foreach (var entry in entries)
        {
            int value = entry.Mood switch
            {
                "Happy" => 3,
                "Neutral" => 2,
                "Sad" => 1,
                _ => 0
            };
            
            moodData.Add(new MoodDataPoint 
            { 
                Date = entry.Timestamp.ToString("MM/dd HH:mm"),
                Value = value
            });
        }
    }
}